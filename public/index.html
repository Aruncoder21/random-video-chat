<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Random Video Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 45%, #000 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: rgba(15, 23, 42, 0.92);
      border-radius: 22px;
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(148, 163, 184, 0.08);
      padding: 18px 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      backdrop-filter: blur(18px);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      background: conic-gradient(from 140deg, #22c55e, #3b82f6, #a855f7, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0b1120;
      font-weight: 800;
      font-size: 18px;
      box-shadow: 0 0 0 2px #020617;
    }

    .brand-text-main {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .brand-text-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .status-pill {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.18);
      border: 1px solid rgba(45, 212, 191, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #a5f3fc;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.25);
    }

    #status {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
      gap: 14px;
    }

    /* Video card */

    .video-card {
      background: linear-gradient(145deg, #020617, #020617);
      border-radius: 18px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border: 1px solid rgba(30, 64, 175, 0.6);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
    }

    .video-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .video-wrapper {
      flex: 1 1 230px;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .video-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .video-label span {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      margin-left: 6px;
      background: rgba(34, 197, 94, 0.12);
      color: #bbf7d0;
    }

    .video-label--stranger span {
      background: rgba(59, 130, 246, 0.12);
      color: #bfdbfe;
    }

    video {
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #020617;
      border-radius: 14px;
      object-fit: cover;
      border: 1px solid rgba(15, 23, 42, 0.9);
      box-shadow:
        inset 0 0 0 1px rgba(148, 163, 184, 0.12),
        0 10px 24px rgba(15, 23, 42, 0.85);
    }

    /* Controls */

    /* ===== BUTTONS (for all controls) ===== */

/* Base style – Uiverse inspired */
button {
  /* accent color har button ke liye alag set hoga niche IDs me */
  --accent: #1BFD9C;

  font-size: 14px;
  padding: 0.65em 2.1em;
  letter-spacing: 0.04em;
  position: relative;
  font-family: inherit;
  border-radius: 0.7em;
  overflow: hidden;
  line-height: 1.3em;

  border: 2px solid var(--accent);
  background: linear-gradient(
    to right,
    rgba(27, 253, 156, 0.06) 1%,
    transparent 40%,
    transparent 60%,
    rgba(27, 253, 156, 0.06) 100%
  );
  color: var(--accent);

  box-shadow:
    inset 0 0 10px rgba(27, 253, 156, 0.18),
    0 0 12px 3px rgba(27, 253, 156, 0.04);

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;

  cursor: pointer;
  transition: all 0.25s cubic-bezier(.2,.9,.2,1);
}

/* Shimmer strip */
button::before {
  content: "";
  position: absolute;
  left: -4.5em;
  width: 4em;
  height: 100%;
  top: 0;
  background: linear-gradient(
    to right,
    transparent 0%,
    rgba(27, 253, 156, 0.08) 40%,
    rgba(27, 253, 156, 0.08) 60%,
    transparent 100%
  );
  transition: transform .4s ease-in-out;
  pointer-events: none;
  mix-blend-mode: screen;
}

button:hover:not(:disabled) {
  color: #ecfeff;
  box-shadow:
    inset 0 0 12px rgba(27, 253, 156, 0.26),
    0 0 18px 6px rgba(27, 253, 156, 0.09);
  transform: translateY(-2px);
}

button:hover:not(:disabled)::before {
  transform: translateX(15em);
}

/* Disabled */
button:disabled {
  opacity: 0.45;
  cursor: default;
  transform: none;
  box-shadow: none;
  color: rgba(226, 232, 240, 0.7);
  border-color: rgba(148, 163, 184, 0.35);
  background: rgba(15, 23, 42, 0.4);
}

button:disabled::before {
  display: none;
}

/* ===== Individual buttons (colors tuned for dark/neon theme) ===== */

/* Start – neon green */
#start-btn {
  --accent: #22c55e;
}

/* Next – purple */
#next-btn {
  --accent: #a855f7;
}

/* Mute / Camera – cyan/blue */
#mute-btn,
#cam-btn {
  --accent: #38bdf8;
}

/* End – red */
#end-btn {
  --accent: #ef4444;
  border-color: rgba(239, 68, 68, 0.9);
  box-shadow:
    inset 0 0 10px rgba(239, 68, 68, 0.18),
    0 0 12px 3px rgba(239, 68, 68, 0.08);
}

/* Small responsive tweak */
#controls {
  gap: 10px;
  flex-wrap: wrap;
}

@media (max-width: 480px) {
  button {
    padding: 0.55em 1.4em;
    font-size: 13px;
  }
}


    /* Chat */

    /* ===== Chat UI (Uiverse-inspired, adapted) ===== */
.chat-card {
  background: linear-gradient(145deg, rgba(3,7,18,0.9), rgba(2,6,23,0.95));
  border-radius: 14px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  border: 1px solid rgba(59,130,246,0.08);
  box-shadow: 0 8px 28px rgba(2,6,23,0.8);
  min-height: 320px;
}

/* header */
.chat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  padding-bottom: 4px;
  border-bottom: 1px solid rgba(100,116,139,0.06);
}
.chat-title {
  font-size: 14px;
  font-weight: 600;
  color: #e6eef9;
}
.chat-sub {
  font-size: 11px;
  color: #9aa6bb;
}

/* chat box */
#chat-area {
  width: 100%;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(6,10,22,0.4), rgba(4,7,18,0.6));
  display: flex;
  flex-direction: column;
  height: 260px;
  overflow: hidden;
  border: 1px solid rgba(30,64,175,0.06);
}

/* messages scroll area */
#chat-messages {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
  scrollbar-width: thin;
}

/* single message */
.chat-msg {
  display: inline-block;
  max-width: 78%;
  padding: 8px 10px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.25;
  word-wrap: break-word;
}

/* my messages (right) */
.me-msg {
  background: linear-gradient(135deg,#2563eb,#1e40af);
  color: #f8fbff;
  margin-left: auto;
  box-shadow: 0 6px 14px rgba(30,64,175,0.24);
  border: 1px solid rgba(59,130,246,0.12);
}

/* stranger messages (left) */
.stranger-msg {
  background: rgba(15,23,42,0.8);
  color: #e6eef9;
  margin-right: auto;
  border: 1px solid rgba(148,163,184,0.06);
}

/* system text (centered small) */
.system-msg {
  text-align: center;
  color: #94a3b8;
  font-size: 12px;
  margin: 6px 0;
}

/* input row */
#chat-input-row {
  display: flex;
  align-items: center;
  gap: 8px;
  border-top: 1px solid rgba(30,64,175,0.06);
  padding-top: 8px;
  background: linear-gradient(180deg, rgba(3,7,18,0.45), rgba(6,10,22,0.55));
  border-radius: 0 0 10px 10px;
}

/* text input */
#chat-input {
  flex: 1;
  height: 44px;
  border: none;
  padding: 10px 12px;
  background: rgba(255,255,255,0.03);
  color: #e6eef9;
  border-radius: 10px;
  outline: none;
  font-size: 14px;
}

/* placeholder color */
#chat-input::placeholder {
  color: #7b8794;
}

/* send button (icon circle) */
#chat-send-btn {
  width: 44px;
  height: 44px;
  border-radius: 999px;
  border: 1px solid rgba(34,197,94,0.12);
  background: linear-gradient(135deg, rgba(34,197,94,0.12), rgba(34,197,94,0.06));
  color: #bbf7d0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform .16s ease, box-shadow .16s ease;
}
#chat-send-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(34,197,94,0.12);
}

/* disabled states */
#chat-send-btn:disabled,
#chat-input:disabled {
  opacity: 0.48;
  cursor: default;
}

/* message timestamp small (optional) */
.msg-time {
  display: block;
  font-size: 11px;
  color: #8694a6;
  margin-bottom: 4px;
}

/* responsive */
@media (max-width: 900px) {
  #chat-area { height: 220px; }
}

:root { --safe-top: env(safe-area-inset-top, 10px); }
html,body{width:100%;height:100%;margin:0;padding:0;-webkit-text-size-adjust:100%;}
.app-shell{max-width:100% !important;padding-top:calc(var(--safe-top) + 10px) !important;}

/* layout containers */
.main-layout{display:grid;grid-template-columns:1fr 36%;gap:18px;}
.video-row,.video-wrapper{display:flex;gap:18px;align-items:stretch;justify-content:space-between;}
.video-card{flex:1 1 0;display:flex;flex-direction:column;gap:12px;min-width:0;}

/* unified video element */
.video-card video{
  width:100% !important;
  height:auto !important;
  aspect-ratio:16/9;
  object-fit:cover !important;
  object-position:center center !important;
  border-radius:12px;
  display:block;
  background:#020617;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,0.02);
}

/* label above video */
.video-label{font-size:12px;letter-spacing:0.08em;color:#9aa6bb;}

/* controls below videos: always centered and wrapped */
#controls{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;align-items:center;padding:8px 6px 12px;margin-top:6px;}
#controls button{min-width:120px;padding:0.6rem 1.2rem;font-size:14px;border-radius:10px;}
#end-btn{margin-left:6px;}

/* chat column */
.chat-card{flex:0 0 36%;min-width:300px;}

/* responsive: stack on small screens */
@media (max-width:900px){
  .main-layout{grid-template-columns:1fr;}
  .chat-card{width:100%;min-width:0;}
  .video-row,.video-wrapper{flex-direction:column;gap:12px;}
  .video-card video{aspect-ratio:16/9;max-height:52vh;}
  #controls{gap:10px;padding-bottom:8px;}
  #controls button{min-width:46%;flex:1 1 46%;}
  .app-shell,.video-card,.chat-card{padding-left:12px !important;padding-right:12px !important;}
}

/* very small phones */
@media (max-width:420px){
  #controls button{min-width:100%;flex:1 1 100%;}
  .video-card video{max-height:48vh;}
}

/* If remote stream is vertical, add class "portrait" on that video element

*/
.video-card video.portrait{object-fit:contain !important;object-position:center center !important;}

#chat-area{display:flex;flex-direction:column;}
#chat-messages{flex:1 1 auto;overflow:auto;}


  </style>
</head>

<body>
  <div class="app-shell">
    <!-- header -->
    <div class="app-header">
      <div class="brand">
        <div class="brand-logo">R</div>
        <div>
          <div class="brand-text-main">Random Video Chat</div>
          <div class="brand-text-sub">Anonymous 1-to-1 video & text</div>
        </div>
      </div>

      <div>
        <div class="status-pill">
          <span class="status-dot"></span>
          Live session
        </div>
        <div id="status">Click “Start” to find a stranger</div>
      </div>
    </div>

    <div class="main-layout">
      <!-- LEFT: Video + controls -->
      <div class="video-card">
        <div class="video-row">
          <div class="video-wrapper">
            <div class="video-label">
              YOU <span>Local</span>
            </div>
            <video id="localVideo" autoplay playsinline muted></video>
          </div>

          <div class="video-wrapper">
            <div class="video-label video-label--stranger">
              STRANGER <span>Remote</span>
            </div>
            <video id="remoteVideo" autoplay playsinline></video>
          </div>
        </div>

        <div id="controls">
          <button id="start-btn">Start</button>
          <button id="next-btn" disabled>Next</button>
          <button id="mute-btn" disabled>Mute</button>
          <button id="cam-btn" disabled>Camera Off</button>
          <button id="end-btn" disabled>End</button>
        </div>
      </div>

      <!-- RIGHT: Chat -->
      <div class="chat-card">
        <div class="chat-header">
          <div class="chat-title">Text chat</div>
          <div style="font-size:11px;color:#6b7280;">Conversations auto-clear on next / end</div>
        </div>

        <div id="chat-area">
          <div id="chat-messages"></div>
          <div id="chat-input-row">
            <input id="chat-input" type="text" placeholder="Type a message..." disabled />
            <button id="chat-send-btn" disabled>Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS (logic same as pehle) -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const statusEl = document.getElementById("status");
    const startBtn = document.getElementById("start-btn");
    const nextBtn = document.getElementById("next-btn");
    const muteBtn = document.getElementById("mute-btn");
    const camBtn = document.getElementById("cam-btn");
    const endBtn = document.getElementById("end-btn");

    const localVideo = document.getElementById("localVideo");
    const remoteVideo = document.getElementById("remoteVideo");

    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");
    const chatSendBtn = document.getElementById("chat-send-btn");

    let pc = null;
    let localStream = null;
    let isInitiator = false;
    let audioEnabled = true;
    let videoEnabled = true;
    let myId = null;

    const rtcConfig = {
      iceServers: [
        { urls: "stun:stun.l.google.com:19302" }
      ]
    };

    socket.on("connect", () => {
      myId = socket.id;
      console.log("Connected with id:", myId);
    });

    function setStatus(text) {
      statusEl.innerText = text;
      console.log(text);
    }

    function addSystemMessage(text) {
      const div = document.createElement("div");
      div.classList.add("system-msg");
      div.innerText = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function addChatMessage(fromId, text) {
      const div = document.createElement("div");
      div.classList.add("chat-msg");

      if (fromId === myId) {
        div.classList.add("me-msg");
        div.innerText = "You: " + text;
      } else {
        div.classList.add("stranger-msg");
        div.innerText = "Stranger: " + text;
      }

      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function setupMedia() {
      if (localStream) return;

      try {
        localStream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: true,
        });
        localVideo.srcObject = localStream;
      } catch (err) {
        console.error("Camera/mic error:", err);
        alert("Camera/mic access denied. Please allow permissions.");
      }
    }

    function createPeerConnection() {
      pc = new RTCPeerConnection(rtcConfig);

      pc.onicecandidate = (event) => {
        if (event.candidate) {
          socket.emit("signal", {
            type: "candidate",
            candidate: event.candidate,
          });
        }
      };

      pc.ontrack = (event) => {
        console.log("Got remote track");
        remoteVideo.srcObject = event.streams[0];
      };

      localStream.getTracks().forEach((track) => {
        pc.addTrack(track, localStream);
      });
    }

    socket.on("partner-found", async (data) => {
      setStatus("Partner found. Connecting...");
      isInitiator = data.initiator;

      await setupMedia();
      createPeerConnection();

      if (isInitiator) {
        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);
        socket.emit("signal", {
          type: "offer",
          sdp: offer.sdp,
        });
      }

      startBtn.disabled = true;
      nextBtn.disabled = false;
      muteBtn.disabled = false;
      camBtn.disabled = false;
      endBtn.disabled = false;

      chatInput.disabled = false;
      chatSendBtn.disabled = false;
      addSystemMessage("You are now connected to a stranger.");
    });

    socket.on("waiting", () => {
      setStatus("Waiting for a partner...");
      addSystemMessage("Waiting for a partner...");
    });

    socket.on("partner-disconnected", () => {
      setStatus("Partner disconnected.");
      addSystemMessage("Stranger disconnected.");
      cleanupCall();
    });

    socket.on("signal", async (data) => {
      if (!pc) {
        await setupMedia();
        createPeerConnection();
      }

      if (data.type === "offer") {
        await pc.setRemoteDescription(
          new RTCSessionDescription({ type: "offer", sdp: data.sdp })
        );
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        socket.emit("signal", {
          type: "answer",
          sdp: answer.sdp,
        });
      } else if (data.type === "answer") {
        await pc.setRemoteDescription(
          new RTCSessionDescription({ type: "answer", sdp: data.sdp })
        );
      } else if (data.type === "candidate") {
        try {
          await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
        } catch (err) {
          console.error("Error adding ICE candidate", err);
        }
      }
    });

    socket.on("chat-message", (data) => {
      addChatMessage(data.from, data.text);
    });

    startBtn.onclick = async () => {
      await setupMedia();
      socket.emit("find-partner");
      setStatus("Searching for a partner...");
      startBtn.disabled = true;
      nextBtn.disabled = true;
      muteBtn.disabled = true;
      camBtn.disabled = true;
      endBtn.disabled = true;
      chatInput.disabled = true;
      chatSendBtn.disabled = true;
      chatMessages.innerHTML = "";
    };

    nextBtn.onclick = () => {
      cleanupCall();
      socket.emit("next");
      setStatus("Searching for a new partner...");
      startBtn.disabled = true;
      nextBtn.disabled = true;
      muteBtn.disabled = true;
      camBtn.disabled = true;
      endBtn.disabled = true;
      chatInput.disabled = true;
      chatSendBtn.disabled = true;
      chatMessages.innerHTML = "";
      addSystemMessage("Searching for a new partner...");
    };

    muteBtn.onclick = () => {
      if (!localStream) return;
      audioEnabled = !audioEnabled;
      localStream.getAudioTracks().forEach(t => (t.enabled = audioEnabled));
      muteBtn.innerText = audioEnabled ? "Mute" : "Unmute";
    };

    camBtn.onclick = () => {
      if (!localStream) return;
      videoEnabled = !videoEnabled;
      localStream.getVideoTracks().forEach(t => (t.enabled = videoEnabled));
      camBtn.innerText = videoEnabled ? "Camera Off" : "Camera On";
    };

    endBtn.onclick = () => {
      cleanupCall();
      setStatus("Call ended. Click Start or Next to find new partner.");
      addSystemMessage("Call ended.");
    };

    function sendChat() {
      const text = chatInput.value.trim();
      if (!text) return;
      socket.emit("chat-message", text);
      chatInput.value = "";
    }

    chatSendBtn.onclick = sendChat;

    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        sendChat();
      }
    });

    function cleanupCall() {
      if (pc) {
        pc.onicecandidate = null;
        pc.ontrack = null;
        pc.close();
        pc = null;
      }

      if (remoteVideo.srcObject) {
        remoteVideo.srcObject.getTracks().forEach(t => t.stop());
        remoteVideo.srcObject = null;
      }

      nextBtn.disabled = true;
      muteBtn.disabled = true;
      camBtn.disabled = true;
      endBtn.disabled = true;

      chatInput.disabled = true;
      chatSendBtn.disabled = true;
    }
  </script>
</body>
</html>



